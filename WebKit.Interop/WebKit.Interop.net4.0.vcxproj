<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <ProjectGuid>{ECF98425-04BB-4601-A527-1325B32129FE}</ProjectGuid>
    <Keyword>MakeFileProj</Keyword>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <ConfigurationType>Makefile</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <OutDir>$(SolutionDir)bin\net4.0\</OutDir>
    <IntDir>$(SolutionDir)obj\net4.0\$(ProjectName)\</IntDir>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <ConfigurationType>Makefile</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <OutDir>$(SolutionDir)bin\net4.0\</OutDir>
    <IntDir>$(SolutionDir)obj\net4.0\$(ProjectName)\</IntDir>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <NMakeOutput>$(OutDir)WebKit.Interop.net4.0.dll</NMakeOutput>
    <NMakePreprocessorDefinitions>WIN32;_DEBUG;$(NMakePreprocessorDefinitions)</NMakePreprocessorDefinitions>
    <NMakeBuildCommandLine>SET OutDir=$(OutDir)
SET IntDir=$(IntDir)
SET SlnDir=$(SolutionDir)

SET FILE1=TypeNormalizer.cs
SET FILE2=%IntDir%TypeNormalizer.exe
IF NOT EXIST "%FILE2%" GOTO:build_normalizer

FOR %%i IN (%FILE1%) DO SET DATE1=%%~ti
FOR %%i IN (%FILE2%) DO SET DATE2=%%~ti
FOR /F %%i IN ('DIR /B /O:D %FILE1% %FILE2%') DO SET NEWEST=%%i
IF "%NEWEST%"=="%FILE1%" GOTO:build_normalizer
GOTO:check_interop

:build_normalizer
ECHO Building TypeNormalizer...
csc /out:"%IntDir%TypeNormalizer.exe" "TypeNormalizer.cs"

:check_interop
SET FILE1="..\webkit\lib\webkit.tlb"
SET FILE2=%OutDir%WebKit.Interop.net4.0.dll
IF NOT EXIST "%FILE2%" GOTO:build_interop

FOR %%i IN (%FILE1%) DO SET DATE1=%%~ti
FOR %%i IN (%FILE2%) DO SET DATE2=%%~ti
FOR /F %%i IN ('DIR /B /O:D %FILE1% %FILE2%') DO SET NEWEST=%%i
IF "%NEWEST%"=="%FILE1%" GOTO:build_interop
GOTO:end

:build_interop
ECHO Fixing WebKit.Interop...
tlbimp "..\webkit\lib\webkit.tlb" /silent /keyfile:"%SlnDir%WebKit.NET.snk" /namespace:WebKit.Interop /out:"%IntDir%WebKit.Interop.net4.0.dll"
ildasm "%IntDir%WebKit.Interop.net4.0.dll" /out="%IntDir%WebKit.Interop.net4.0.il" /nobar
"%IntDir%TypeNormalizer.exe" "%IntDir%WebKit.Interop.net4.0.il"
ilasm "%IntDir%WebKit.Interop.net4.0.il" /dll /optimize /output="%OutDir%WebKit.Interop.net4.0.dll" /key="%SlnDir%WebKit.NET.snk"

:end</NMakeBuildCommandLine>
    <NMakeReBuildCommandLine>SET OutDir=$(OutDir)
SET IntDir=$(IntDir)
SET SlnDir=$(SolutionDir)

:build_normalizer
ECHO Building TypeNormalizer...
csc /out:"%IntDir%TypeNormalizer.exe" "TypeNormalizer.cs"

:build_interop
ECHO Fixing WebKit.Interop...
tlbimp "..\webkit\lib\webkit.tlb" /silent /keyfile:"%SlnDir%WebKit.NET.snk" /namespace:WebKit.Interop /out:"%IntDir%WebKit.Interop.net4.0.dll"
ildasm "%IntDir%WebKit.Interop.net4.0.dll" /out="%IntDir%WebKit.Interop.net4.0.il" /nobar
"%IntDir%TypeNormalizer.exe" "%IntDir%WebKit.Interop.net4.0.il"
ilasm "%IntDir%WebKit.Interop.net4.0.il" /dll /optimize /output="%OutDir%WebKit.Interop.net4.0.dll" /key="%SlnDir%WebKit.NET.snk"

:end</NMakeReBuildCommandLine>
    <NMakeCleanCommandLine>SET OutDir=$(OutDir)
SET IntDir=$(IntDir)

IF EXIST "%IntDir%TypeNormalizer.exe" del "%IntDir%TypeNormalizer.exe"
IF EXIST "%OutDir%WebKit.Interop.net4.0.dll" del "%OutDir%WebKit.Interop.net4.0.dll"</NMakeCleanCommandLine>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <NMakeOutput>$(OutDir)WebKit.Interop.net4.0.dll</NMakeOutput>
    <NMakePreprocessorDefinitions>WIN32;NDEBUG;$(NMakePreprocessorDefinitions)</NMakePreprocessorDefinitions>
    <NMakeBuildCommandLine>SET OutDir=$(OutDir)
SET IntDir=$(IntDir)
SET SlnDir=$(SolutionDir)

SET FILE1=TypeNormalizer.cs
SET FILE2=%IntDir%TypeNormalizer.exe
IF NOT EXIST "%FILE2%" GOTO:build_normalizer

FOR %%i IN (%FILE1%) DO SET DATE1=%%~ti
FOR %%i IN (%FILE2%) DO SET DATE2=%%~ti
FOR /F %%i IN ('DIR /B /O:D %FILE1% %FILE2%') DO SET NEWEST=%%i
IF "%NEWEST%"=="%FILE1%" GOTO:build_normalizer
GOTO:check_interop

:build_normalizer
ECHO Building TypeNormalizer...
csc /out:"%IntDir%TypeNormalizer.exe" "TypeNormalizer.cs"

:check_interop
SET FILE1="..\webkit\lib\webkit.tlb"
SET FILE2=%OutDir%WebKit.Interop.net4.0.dll
IF NOT EXIST "%FILE2%" GOTO:build_interop

FOR %%i IN (%FILE1%) DO SET DATE1=%%~ti
FOR %%i IN (%FILE2%) DO SET DATE2=%%~ti
FOR /F %%i IN ('DIR /B /O:D %FILE1% %FILE2%') DO SET NEWEST=%%i
IF "%NEWEST%"=="%FILE1%" GOTO:build_interop
GOTO:end

:build_interop
ECHO Fixing WebKit.Interop...
tlbimp "..\webkit\lib\webkit.tlb" /silent /keyfile:"%SlnDir%WebKit.NET.snk" /namespace:WebKit.Interop /out:"%IntDir%WebKit.Interop.net4.0.dll"
ildasm "%IntDir%WebKit.Interop.net4.0.dll" /out="%IntDir%WebKit.Interop.net4.0.il" /nobar
"%IntDir%TypeNormalizer.exe" "%IntDir%WebKit.Interop.net4.0.il"
ilasm "%IntDir%WebKit.Interop.net4.0.il" /dll /optimize /output="%OutDir%WebKit.Interop.net4.0.dll" /key="%SlnDir%WebKit.NET.snk"

:end</NMakeBuildCommandLine>
    <NMakeReBuildCommandLine>SET OutDir=$(OutDir)
SET IntDir=$(IntDir)
SET SlnDir=$(SolutionDir)

:build_normalizer
ECHO Building TypeNormalizer...
csc /out:"%IntDir%TypeNormalizer.exe" "TypeNormalizer.cs"

:build_interop
ECHO Fixing WebKit.Interop...
tlbimp "..\webkit\lib\webkit.tlb" /silent /keyfile:"%SlnDir%WebKit.NET.snk" /namespace:WebKit.Interop /out:"%IntDir%WebKit.Interop.net4.0.dll"
ildasm "%IntDir%WebKit.Interop.net4.0.dll" /out="%IntDir%WebKit.Interop.net4.0.il" /nobar
"%IntDir%TypeNormalizer.exe" "%IntDir%WebKit.Interop.net4.0.il"
ilasm "%IntDir%WebKit.Interop.net4.0.il" /dll /optimize /output="%OutDir%WebKit.Interop.net4.0.dll" /key="%SlnDir%WebKit.NET.snk"

:end</NMakeReBuildCommandLine>
    <NMakeCleanCommandLine>SET OutDir=$(OutDir)
SET IntDir=$(IntDir)

IF EXIST "%IntDir%TypeNormalizer.exe" del "%IntDir%TypeNormalizer.exe"
IF EXIST "%OutDir%WebKit.Interop.net4.0.dll" del "%OutDir%WebKit.Interop.net4.0.dll"</NMakeCleanCommandLine>
  </PropertyGroup>
  <ItemDefinitionGroup>
  </ItemDefinitionGroup>
  <ItemGroup>
    <None Include="TypeNormalizer.cs" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>